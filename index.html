<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SharePoint Document Library</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://alcdn.msauth.net/browser/2.36.0/js/msal-browser.min.js"></script>
</head>
<body class="bg-gray-100 text-gray-800">
    <header class="bg-blue-600 text-white py-4">
        <div class="container mx-auto flex justify-between items-center px-6">
            <h1 class="text-2xl font-bold">Document Library</h1>
            <button id="loginBtn" class="bg-white text-blue-600 px-4 py-2 rounded-lg hover:bg-blue-100">
                Login
            </button>
            <button id="logoutBtn" class="bg-red-600 text-white px-4 py-2 rounded-lg hover:bg-red-700 hidden">
                Logout
            </button>
        </div>
    </header>

    <main class="container mx-auto p-6">
        <section id="status" class="text-center mb-6"></section>
        <table id="documentsTable" class="table-auto w-full bg-white shadow-lg rounded-lg overflow-hidden hidden">
            <thead>
                <tr class="bg-blue-600 text-white">
                    <th class="px-4 py-2">File Name</th>
                    <th class="px-4 py-2">Modified By</th>
                    <th class="px-4 py-2">Last Modified</th>
                    <th class="px-4 py-2">Size</th>
                </tr>
            </thead>
            <tbody class="text-center"></tbody>
        </table>
    </main>

    <script>
        const msalConfig = {
            auth: {
                clientId: "YOUR_CLIENT_ID", // Replace with your Azure App Client ID
                authority: "https://login.microsoftonline.com/YOUR_TENANT_ID", // Replace with your Tenant ID
                redirectUri: window.location.origin
            }
        };

        const msalInstance = new msal.PublicClientApplication(msalConfig);
        const loginRequest = { scopes: ["Sites.Read.All"] };

        const siteId = "YOUR_SITE_ID"; // Replace with your SharePoint Site ID
        const documentLibraryId = "YOUR_LIBRARY_ID"; // Replace with your SharePoint Document Library ID

        document.getElementById("loginBtn").addEventListener("click", () => {
            msalInstance.loginPopup(loginRequest)
                .then((loginResponse) => {
                    document.getElementById("status").innerText = `Logged in as: ${loginResponse.account.username}`;
                    document.getElementById("loginBtn").classList.add("hidden");
                    document.getElementById("logoutBtn").classList.remove("hidden");
                    fetchDocuments();
                })
                .catch((error) => console.error("Login failed:", error));
        });

        document.getElementById("logoutBtn").addEventListener("click", () => {
            msalInstance.logoutPopup()
                .then(() => {
                    document.getElementById("status").innerText = "Logged out.";
                    document.getElementById("loginBtn").classList.remove("hidden");
                    document.getElementById("logoutBtn").classList.add("hidden");
                    document.getElementById("documentsTable").classList.add("hidden");
                });
        });

        function fetchDocuments() {
            msalInstance.acquireTokenSilent(loginRequest)
                .then((tokenResponse) => {
                    const accessToken = tokenResponse.accessToken;
                    fetch(`https://graph.microsoft.com/v1.0/sites/${siteId}/drives/${documentLibraryId}/root/children`, {
                        headers: { Authorization: `Bearer ${accessToken}` }
                    })
                        .then((response) => response.json())
                        .then((data) => {
                            displayDocuments(data.value);
                        })
                        .catch((error) => console.error("Error fetching documents:", error));
                })
                .catch((error) => {
                    console.error("Token acquisition failed:", error);
                    msalInstance.acquireTokenPopup(loginRequest);
                });
        }

        function displayDocuments(documents) {
            const table = document.getElementById("documentsTable");
            const tbody = table.querySelector("tbody");
            tbody.innerHTML = "";

            documents.forEach((doc) => {
                const row = document.createElement("tr");
                row.className = "border-b border-gray-200";

                row.innerHTML = `
                    <td class="px-4 py-2 text-left text-blue-600 hover:underline">
                        <a href="${doc.webUrl}" target="_blank">${doc.name}</a>
                    </td>
                    <td class="px-4 py-2">${doc.lastModifiedBy?.user?.displayName || "Unknown"}</td>
                    <td class="px-4 py-2">${new Date(doc.lastModifiedDateTime).toLocaleDateString()}</td>
                    <td class="px-4 py-2">${(doc.size / 1024).toFixed(2)} KB</td>
                `;
                tbody.appendChild(row);
            });

            table.classList.remove("hidden");
        }
    </script>
</body>
</html>
